<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Extraction Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #0f0;
            font-family: monospace;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border: 1px solid #0f0;
        }
    </style>
</head>
<body>
    <div id="info">
        <h3>üîç Face Extraction Test</h3>
        <div id="status">Loading...</div>
    </div>
    
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';
        import { GLTFLoader } from 'https://unpkg.com/three@0.158.0/examples/jsm/loaders/GLTFLoader.js';
        import { LaserSystem } from './LaserSystem.js';

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const statusDiv = document.getElementById('status');

        // Load the model and test face extraction
        const gltfLoader = new GLTFLoader();
        const modelUrl = './models/wirehead-4-alpha.glb';

        statusDiv.innerHTML = 'Loading model...';

        gltfLoader.load(
            modelUrl,
            (gltf) => {
                const model = gltf.scene;
                scene.add(model);
                
                statusDiv.innerHTML = 'Model loaded. Extracting faces...';
                
                // Create LaserSystem to test face extraction
                const laserSystem = new LaserSystem(scene, model, null, camera);
                
                // Test face extraction
                setTimeout(() => {
                    const faceCount = laserSystem.modelFaces.length;
                    const vertexCount = laserSystem.modelVertices.length;
                    
                    statusDiv.innerHTML = `
                        ‚úÖ Extraction Complete<br>
                        üìä Vertices: ${vertexCount}<br>
                        üî∫ Faces: ${faceCount}<br>
                        <br>
                        Testing random face selection...
                    `;
                    
                    // Test random face selection
                    for (let i = 0; i < 5; i++) {
                        const randomFace = laserSystem.getRandomModelFace();
                        console.log(`Random face ${i}:`, {
                            center: randomFace.center,
                            normal: randomFace.normal,
                            vertices: randomFace.vertices.length
                        });
                    }
                    
                    statusDiv.innerHTML += `<br>‚úÖ Check console for face details`;
                    
                }, 100);
            },
            (progress) => {
                const percent = Math.round((progress.loaded / progress.total) * 100);
                statusDiv.innerHTML = `Loading model... ${percent}%`;
            },
            (error) => {
                statusDiv.innerHTML = `‚ùå Error loading model: ${error}`;
                console.error('Error loading model:', error);
            }
        );

        // Basic scene setup
        camera.position.z = 5;
        
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
